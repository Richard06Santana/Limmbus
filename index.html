<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Controle de Saída - V 1.2.7</title>
    <style>
        /* Estilo Minimalista Geométrico - Dark Mode V 1.2.7 */
        * { box-sizing: border-box; }
        body { 
            background-color: #0a0a0a; 
            color: #e0e0e0; 
            font-family: 'Segoe UI', sans-serif; 
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        .container { 
            background: #121212; 
            padding: 40px; 
            width: 100%;
            max-width: 450px; 
            border: 1px solid #333; 
            box-shadow: 12px 12px 0px #1a1a1a;
        }

        h2 { 
            margin: 0 0 20px 0; 
            border-left: 5px solid #fff; 
            padding-left: 15px; 
            color: #fff; 
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 1.4rem;
        }

        label { display: block; font-size: 0.85rem; margin-top: 20px; color: #888; }

        input, textarea { 
            width: 100%; padding: 12px; margin-top: 8px; 
            border: 1px solid #333; background: #1a1a1a;
            color: #fff; outline: none;
        }
        input:focus, textarea:focus { border-color: #fff; }

        .row { display: flex; gap: 15px; }
        .row div { flex: 1; }

        button { 
            width: 100%; margin-top: 30px; padding: 15px; 
            background: #fff; color: #000; border: none; 
            font-weight: bold; cursor: pointer; transition: 0.3s;
            text-transform: uppercase;
        }
        button:hover { background: #ccc; }

        .status-msg { margin-top: 15px; font-size: 0.8rem; color: #2ecc71; opacity: 0; transition: 0.5s; height: 20px; text-align: center; }

        .link-tabela {
            margin-top: 20px;
            color: #666;
            text-decoration: none;
            font-size: 0.8rem;
            border-bottom: 1px solid #222;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>Controle de Saída</h2>
    <form id="formLimmbus">
        <label>Nome do funcionário</label>
        <input type="text" id="nome" class="tab-input" placeholder="Nome completo" required autofocus>

        <label>Data</label>
        <input type="date" id="data" class="tab-input" required>

        <div class="row">
            <div>
                <label>Entrada</label>
                <input type="time" id="entrada" class="tab-input" required>
            </div>
            <div>
                <label>Saída</label>
                <input type="time" id="saida" class="tab-input" required>
            </div>
        </div>

        <label>Descrição ou Observações</label>
        <textarea id="descricao" class="tab-input" rows="2" placeholder="Escreva os detalhes aqui..."></textarea>

        <button type="submit" id="btnSalvar">Salvar registro</button>
        <div id="msgSucesso" class="status-msg">Registro salvo com sucesso!</div>
    </form>
</div>

<a href="#" onclick="abrirTabela()" class="link-tabela">Acessar log de alterações</a>

<script>
    const inputs = document.querySelectorAll('.tab-input');
    inputs.forEach((input, index) => {
        input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                const nextInput = inputs[index + 1];
                if (nextInput) {
                    nextInput.focus();
                } else {
                    document.getElementById('btnSalvar').click();
                }
            }
        });
    });

    function calcularDiferenca(inicio, fim) {
        const [h1, m1] = inicio.split(':').map(Number);
        const [h2, m2] = fim.split(':').map(Number);
        let diffMs = (h2 * 60 + m2) - (h1 * 60 + m1);
        if (diffMs < 0) diffMs += 1440;
        return Math.floor(diffMs / 60) + "h " + (diffMs % 60) + "m";
    }

    function calcularAteMeta(saida) {
        const [hS, mS] = saida.split(':').map(Number);
        const metaMinutos = (17 * 60) + 30;
        const saidaMinutos = (hS * 60) + mS;
        const diff = metaMinutos - saidaMinutos;
        if (diff > 0) return "Faltavam " + Math.floor(diff / 60) + "h " + (diff % 60) + "m";
        if (diff < 0) return "Extra de " + Math.floor(Math.abs(diff) / 60) + "h " + (Math.abs(diff) % 60) + "m";
        return "No horário (17:30)";
    }

    document.getElementById('formLimmbus').addEventListener('submit', function(e) {
        e.preventDefault();
        const dados = {
            id: Date.now(),
            nome: document.getElementById('nome').value,
            data: document.getElementById('data').value,
            entrada: document.getElementById('entrada').value,
            saida: document.getElementById('saida').value,
            total: calcularDiferenca(document.getElementById('entrada').value, document.getElementById('saida').value),
            meta: calcularAteMeta(document.getElementById('saida').value),
            obs: document.getElementById('descricao').value
        };

        let registros = JSON.parse(localStorage.getItem('limmbus_db')) || [];
        registros.push(dados);
        localStorage.setItem('limmbus_db', JSON.stringify(registros));

        document.getElementById('msgSucesso').style.opacity = '1';
        setTimeout(() => { document.getElementById('msgSucesso').style.opacity = '0'; }, 2000);
        this.reset();
        inputs[0].focus();
    });

    function abrirTabela() {
        const registros = JSON.parse(localStorage.getItem('limmbus_db')) || [];
        const novaAba = window.open("", "_blank");
        
        let linhasHtml = registros.map(item => `
            <tr id="row-${item.id}" style="border-bottom:1px solid #222;">
                <td style="padding:12px;">${item.nome}</td>
                <td style="padding:12px;">${item.data}</td>
                <td style="padding:12px;">${item.entrada}</td>
                <td style="padding:12px;">${item.saida}</td>
                <td style="padding:12px; font-weight:bold;">${item.total}</td>
                <td style="padding:12px; color:#aaa;">${item.meta}</td>
                <td style="padding:12px;">${item.obs}</td>
                <td style="padding:12px;"><button onclick="mostrarModal('${item.id}')" style="background:none; border:none; color:#ff4d4d; cursor:pointer; font-size:0.8rem;">✖ Remover</button></td>
            </tr>
        `).join('');

        let fullHtml = `
            <head><title>Log de Alterações</title></head>
            <body style="background:#0a0a0a; color:#fff; font-family:sans-serif; padding:50px; margin:0;">
                <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:2px solid #fff; padding-bottom:10px;">
                    <h1 style="font-weight:300; margin:0; text-transform:uppercase; letter-spacing:1px;">Log de Alterações</h1>
                    <button onclick="mostrarModal('all')" style="background:transparent; color:#ff4d4d; border:1px solid #ff4d4d; padding:10px; cursor:pointer; font-weight:bold;">Limpar tudo</button>
                </div>
                <table style="width:100%; border-collapse:collapse; margin-top:20px;">
                    <thead style="background:#1a1a1a; text-align:left;">
                        <tr>
                            <th style="padding:15px;">Funcionário</th><th style="padding:15px;">Data</th><th style="padding:15px;">Entrada</th>
                            <th style="padding:15px;">Saída</th><th style="padding:15px;">Total</th><th style="padding:15px;">Saldo 17:30</th>
                            <th style="padding:15px;">Observação</th><th style="padding:15px;">Ação</th>
                        </tr>
                    </thead>
                    <tbody>${linhasHtml}</tbody>
                </table>
                <div id="modalSenha" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); justify-content:center; align-items:center;">
                    <div style="background:#121212; padding:30px; border:1px solid #333; text-align:center; max-width:300px; width:90%;">
                        <h3 style="margin-top:0;">Segurança</h3>
                        <p style="color:#888; font-size:0.9rem;">Senha para confirmar:</p>
                        <input type="password" id="inputSenha" style="background:#1a1a1a; border:1px solid #333; color:#fff; padding:10px; margin-bottom:20px; width:100%; text-align:center; outline:none;">
                        <div style="display:flex; gap:10px;">
                            <button onclick="validarSenha()" style="background:#fff; color:#000; border:none; padding:10px; cursor:pointer; font-weight:bold; flex:1;">OK</button>
                            <button onclick="fecharModal()" style="background:#333; color:#fff; border:none; padding:10px; cursor:pointer; flex:1;">Sair</button>
                        </div>
                    </div>
                </div>
                <script>
                    let acaoAtual = '';
                    function mostrarModal(id) { acaoAtual = id; document.getElementById('modalSenha').style.display = 'flex'; document.getElementById('inputSenha').focus(); }
                    function fecharModal() { document.getElementById('modalSenha').style.display = 'none'; document.getElementById('inputSenha').value = ''; }
                    function validarSenha() {
                        if (document.getElementById('inputSenha').value === "1979") {
                            if(acaoAtual === 'all') {
                                localStorage.removeItem('limmbus_db');
                                window.close();
                            } else {
                                let db = JSON.parse(localStorage.getItem('limmbus_db')) || [];
                                db = db.filter(r => r.id != acaoAtual);
                                localStorage.setItem('limmbus_db', JSON.stringify(db));
                                document.getElementById('row-' + acaoAtual).remove();
                                fecharModal();
                            }
                        } else { alert("Senha incorreta!"); fecharModal(); }
                    }
                    document.getElementById('inputSenha').addEventListener('keypress', (e) => { if(e.key === 'Enter') validarSenha(); });
                <\/script>
                <p style='color:#444; margin-top:30px; font-size:0.8rem;'>V 1.2.7</p>
            </body>
        `;
        novaAba.document.write(fullHtml);
    }
</script>

</body>
</html>
